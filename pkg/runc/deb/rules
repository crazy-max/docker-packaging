#!/usr/bin/make -f

# force packages to be built with xz compression, as Ubuntu 21.10 and up use
# zstd compression, which is non-standard, and breaks 'dpkg-sig --verify'
override_dh_builddeb:
	dh_builddeb -- -Zxz

override_dh_auto_build:
	mkdir -p /go/src/github.com/opencontainers && \
	ln -snf $(CURDIR)/runc /go/src/github.com/opencontainers/runc && \
	cd /go/src/github.com/opencontainers/runc && \
	GO111MODULE=auto make BINDIR="$$(pwd)/bin" VERSION=$${VERSION} COMMIT=$${REVISION} runc install && \
	GO111MODULE=auto make man

override_dh_strip:
	# Go has lots of problems with stripping, so just don't

override_dh_auto_install:
	install -D -m 0755 runc/bin/runc debian/runc/usr/bin/runc

override_dh_installinit:
	dh_installinit

override_dh_install:
	dh_install

%:
	dh $@ --with=bash-completion
